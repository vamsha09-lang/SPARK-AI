<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spark AI</title>

<style>
:root{
  --bg:#00054c;
  --card:#020617;
  --text:#ffffff;
  --user:#2563eb;
  --bot:#1e293b;
}

body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* LOGIN */
#login{
  background:var(--card);
  padding:30px;
  border-radius:15px;
  width:300px;
  text-align:center;
}
#login input, #login button{
  width:100%;
  margin:8px 0;
  padding:10px;
  border-radius:8px;
  border:none;
}
#login button{
  background:#2563eb;
  color:white;
  cursor:pointer;
}

/* APP */
#app{
  display:none;
  width:100%;
  height:100vh;
  background:white;
}

/* LAYOUT */
#layout{
  display:flex;
  height:100%;
}

/* SIDEBAR */
#sidebar{
  width:220px;
  background:#020617;
  color:white;
  padding:10px;
  overflow-y:auto;
}
#newChat{
  width:100%;
  padding:8px;
  margin-bottom:10px;
  background:#2563eb;
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
}
#history li{
  list-style:none;
  padding:8px;
  margin-bottom:6px;
  background:#1e293b;
  border-radius:6px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#history li span{
  flex:1;
}
#history button{
  background:none;
  border:none;
  color:white;
  cursor:pointer;
}

/* CHAT */
#chat{
  flex:1;
  display:flex;
  flex-direction:column;
}
header{
  background:#00054c;
  color:white;
  padding:12px;
  display:flex;
  justify-content:space-between;
}
#messages{
  flex:1;
  padding:12px;
  overflow-y:auto;
}
.msg{
  margin:8px 0;
  padding:10px;
  border-radius:10px;
  max-width:70%;
}
.user{
  background:#2563eb;
  color:white;
  margin-left:auto;
}
.bot{
  background:#1e293b;
  color:white;
}
footer{
  display:flex;
  padding:10px;
  gap:6px;
}
footer input{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:none;
}
footer button{
  padding:0 16px;
  background:#2563eb;
  color:white;
  border:none;
  border-radius:8px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <h2>‚ö° Spark AI</h2>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <p id="error" style="color:red"></p>
</div>

<!-- APP -->
<div id="app">
  <div id="layout">

    <!-- SIDEBAR -->
    <div id="sidebar">
      <button id="newChat">‚ûï New Chat</button>
      <ul id="history"></ul>
    </div>

    <!-- CHAT -->
    <div id="chat">
      <header>
        <div>‚ö° Spark AI</div>
        <button id="clearBtn">üóëÔ∏è</button>
      </header>

      <div id="messages"></div>

      <footer>
        <input id="input" placeholder="Type message...">
        <button id="send">‚û§</button>
      </footer>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* LOGIN */
const USER="admin", PASS="Pranavam21@";
loginBtn.onclick=()=>{
  if(user.value===USER && pass.value===PASS){
    login.style.display="none";
    app.style.display="block";
    init();
  }else error.innerText="Wrong login";
};

/* STORAGE */
function key(){ return "spark_"+user.value; }
function loadData(){
  return JSON.parse(localStorage.getItem(key()) || '{"chats":{},"active":null}');
}
function saveData(d){ localStorage.setItem(key(),JSON.stringify(d)); }

let current=null;

/* INIT */
function init(){
  const d=loadData();
  if(!d.active) newChat();
  else loadChat(d.active);
  render();
}

/* NEW CHAT */
function newChat(){
  const d=loadData();
  const id="chat_"+Date.now();
  d.chats[id]={ title:"New Chat", messages:[] };
  d.active=id;
  saveData(d);
  current=id;
  messages.innerHTML="";
  render();
}
newChatBtn=newChat;
newChat.onclick=newChat;

/* RENDER SIDEBAR */
function render(){
  history.innerHTML="";
  const d=loadData();
  Object.keys(d.chats).forEach(id=>{
    const li=document.createElement("li");
    const span=document.createElement("span");
    span.innerText=d.chats[id].title;
    span.onclick=()=>loadChat(id);

    const edit=document.createElement("button");
    edit.innerText="‚úèÔ∏è";
    edit.onclick=()=>{
      const t=prompt("Rename chat",d.chats[id].title);
      if(t){ d.chats[id].title=t; saveData(d); render(); }
    };

    const del=document.createElement("button");
    del.innerText="üóëÔ∏è";
    del.onclick=()=>{
      if(confirm("Delete chat?")){
        delete d.chats[id];
        d.active=null;
        saveData(d);
        newChat();
      }
    };

    li.append(span,edit,del);
    if(id===d.active) li.style.background="#2563eb";
    history.appendChild(li);
  });
}

/* LOAD CHAT */
function loadChat(id){
  const d=loadData();
  current=id;
  d.active=id;
  saveData(d);
  messages.innerHTML="";
  d.chats[id].messages.forEach(m=>add(m.text,m.type,false));
}

/* ADD MESSAGE */
function add(text,type,save=true){
  const div=document.createElement("div");
  div.className="msg "+type;
  div.innerText=text;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;

  if(save){
    const d=loadData();
    d.chats[current].messages.push({text,type});
    if(type==="user" && d.chats[current].messages.length===1)
      d.chats[current].title=text.slice(0,20);
    saveData(d);
    render();
  }
}

/* SEND */
async function sendMsg(){
  const t=input.value.trim();
  if(!t) return;
  add(t,"user");
  input.value="";
  add("Typing...","bot",false);

  try{
    const r=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});
    const d=await r.json();
    messages.lastChild.remove();
    add(d.reply,"bot");
  }catch{
    messages.lastChild.remove();
    add("‚ùå Error","bot");
  }
}
send.onclick=sendMsg;
input.onkeydown=e=>{ if(e.key==="Enter") sendMsg(); };

/* CLEAR */
clearBtn.onclick=()=>{
  if(confirm("Clear chat?")){
    const d=loadData();
    d.chats[current].messages=[];
    saveData(d);
    messages.innerHTML="";
  }
};

});
</script>
</body>
</html>
